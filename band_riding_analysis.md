# 볼린저 밴드 타기(Band Riding) 감지 기능 분석

## 개요
볼린저 밴드 타기는 주가가 상단 밴드에 연속적으로 접촉하며 상승하는 현상을 말합니다. 이는 강한 상승 추세를 나타내는 중요한 지표이며, 매매 결정에 있어 중요한 참고 요소가 됩니다.

## 구현 내용

### 기본 개념
- **밴드 타기 정의**: 주가가 연속 3일 이상 상단 밴드(%B > 0.8)에 접촉하는 현상
- **강도 측정**: 상단 밴드 접촉 시 %B 값의 평균에 기반하여 0-100% 척도로 표시
- **강한 추세 판별**: 가격 상승일이 70% 이상이고, 거래량 증가 또는 %B가 매우 높은(0.9 이상) 경우

### 주요 기능 (`detect_band_riding`)
1. **밴드 타기 감지**
   - `main.py`의 132-193 라인에 구현
   - lookback 기간(기본값 5일) 동안의 상단 밴드 접촉 패턴 분석
   - 연속 3일 이상 접촉 시 밴드 타기로 판단

2. **밴드 타기 강도 계산**
   - 계산식: `(avg_b - 0.8) * 500` (최대 100%)
   - %B 값이 높을수록 강도가 강함

3. **강한 상승 추세 감지**
   - 조건: 가격 상승일 비율 ≥ 70% + (거래량 증가 또는 %B > 0.9)
   - 강한 추세 시 매도보다 추세 추종 권장 (트레일링 스탑 활용)

## 밴드 타기 유형 분류

### 1. 강한 밴드 타기
- **특징**:
  - 연속 3일 이상 상단 밴드 접촉
  - 높은 %B 값 (평균 0.9 이상)
  - 거래량 증가 패턴
  - 가격 상승일 70% 이상
- **전략**: 매도보다 추세 추종 권장 (트레일링 스탑 전략)

### 2. 일반 밴드 타기
- **특징**:
  - 연속 3일 이상 상단 밴드 접촉
  - 중간 수준의 %B 값 (0.8~0.9)
  - 거래량 증가가 뚜렷하지 않음
- **전략**: 상단 밴드 지속 접촉 시 주시, 중심선 아래로 돌파 시 매도 고려

### 3. 약한 밴드 타기 (밴드 타기로 인정되지 않음)
- **특징**:
  - 상단 밴드 접촉이 연속 3일 미만
  - 비연속적 상단 밴드 접촉
  - 낮은 거래량
- **전략**: 밴드 타기로 인정되지 않으므로 일반적인 매매 기준 적용

## 테스트 구현 (`test_band_riding.py`)

7개의 테스트 케이스를 통해 다양한 시나리오에서 밴드 타기 감지 기능이 정상 작동하는지 검증:

1. `test_normal_band_riding_detection`: 일반적인 밴드 타기 감지
2. `test_strong_band_riding_detection`: 강한 밴드 타기 감지
3. `test_weak_band_riding_detection`: 약한 패턴(밴드 타기 아님) 감지
4. `test_no_band_riding`: 밴드 타기가 없는 경우
5. `test_lookback_period`: 조회 기간 변경에 따른 결과 변화
6. `test_trend_strength_detection`: 추세 강도 감지 정확성
7. `test_consecutive_days_requirement`: 연속 접촉일 요구사항 검증

## 신호 처리 통합 (`signal.py`)

`generate_trading_signal` 함수에서 밴드 타기 감지 결과를 매매 신호 생성에 활용:

- 밴드 타기가 감지되면 매도 신호 우선 발생
- 강한 추세로 판단되는 경우 추세 추종 메시지 생성
- 결과를 알림 메시지에 포함하여 사용자에게 정보 제공

## 결론

볼린저 밴드 타기 감지 기능은 성공적으로 구현되었으며, 모든 테스트가 통과됩니다. 이 기능은 매매 결정에 중요한 추세 정보를 제공하며, 특히 강한 추세와 일반 추세를 구분함으로써 매도 시점 결정에 도움을 줍니다.

추세 감지의 정확도를 높이기 위해 거래량 증가와 가격 상승 패턴을 함께 분석하는 방식이 효과적으로 동작하고 있습니다. 