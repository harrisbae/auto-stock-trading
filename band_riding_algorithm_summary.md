# 볼린저 밴드 밴드타기(Band Riding) 알고리즘 요약

## 개요
밴드타기 감지 알고리즘은 주가가 볼린저 밴드 상단에 연속적으로 접촉하는 현상을 감지하고, 이를 단순 접촉과 강한 추세로 구분하여 차별화된 매매 전략을 제공합니다. 이 알고리즘은 단순히 기술적 지표에만 의존하지 않고, 가격 움직임의 맥락과 거래량을 함께 고려하여 보다 정교한 매매 의사결정을 지원합니다.

## 밴드타기 감지 메커니즘

### 기본 감지 로직
- **정의**: 주가가 볼린저 밴드 상단(%B > 0.8)에 3일 이상 연속으로 접촉하는 현상
- **강도 측정**: `(avg_b - 0.8) * 500`으로 계산, 0-100 범위의 값으로 표현
- **연속성 요구**: 최소 3일 이상 연속으로 상단 밴드 접촉 필요

### 강한 추세 vs 일반 밴드타기 구분

#### 강한 밴드타기(강한 추세) 조건
- 가격 상승일이 최근 기간의 70% 이상 (`price_trend >= 0.7`)
- 추가 조건(둘 중 하나):
  - 최근 거래량이 평균보다 20% 이상 증가
  - %B 값이 매우 높음(0.9 초과)

#### 일반 밴드타기
- 연속 3일 이상 상단 밴드 접촉
- 강한 추세 조건을 충족하지 않음

## 매매 신호 및 전략

### 강한 밴드타기 감지 시
```
강한 상승 추세 감지: 단순 상단 접촉만으로 매도하지 말고 추세 지속 관찰 권장
- 강한 상승 추세 유지 중: 상단 접촉만으로 매도하지 말고 추세 모멘텀 활용
- 트레일링 스탑(Trailing Stop) 전략으로 이익 보호하며 추세 추종
```

### 일반 밴드타기 감지 시
```
- 상단밴드에 지속 접촉 시 밴드 타기 현상 주시
- 중심선(MA25) 아래로 돌파 시 잔여 물량 매도 고려
```

## 테스트 구조 및 결과

### 주요 테스트 케이스
1. **일반 밴드타기 감지 테스트**
   - 거래량 감소 및 격일 가격 하락 패턴으로 강한 추세가 아니라고 판단되도록 설계
   - `is_riding=True`, `is_strong_trend=False` 검증

2. **강한 밴드타기 감지 테스트**
   - 거래량 지속 증가, 높은 %B 값, 지속적 가격 상승으로 강한 추세 시뮬레이션
   - `is_riding=True`, `is_strong_trend=True` 검증

3. **약한 패턴 테스트**
   - %B 값이 0.8 미만인 경우 밴드타기로 감지되지 않음 검증
   - `is_riding=False` 검증

4. **연속일수 요구조건 테스트**
   - 2일만 상단 밴드에 접촉한 경우 밴드타기로 감지되지 않음 검증
   - 최소 3일 연속 요구조건 확인

### 테스트 결과
총 7개 테스트 케이스가 모두 성공적으로 통과:
```
----------------------------------------------------------------------
Ran 7 tests in 0.132s
OK
```

## 실전 적용 전략

### 강한 추세 감지 시
1. 단순 상단 밴드 접촉만으로 매도하지 않음
2. 트레일링 스탑 전략으로 추세 추종하며 이익 보호
3. 고점에서 매도하기보다 추세 모멘텀 활용

### 일반 밴드타기 감지 시
1. 기술적으로는 매도 신호 생성
2. 중심선(MA25) 아래로 돌파 시점을 매도 타이밍으로 고려
3. 잔여 물량에 대한 단계적 매도 전략 구현

## 결론
볼린저 밴드 밴드타기 감지 알고리즘은 단순히 상단 밴드 접촉 여부만으로 매도 결정을 내리지 않고, 추세의 강도와 지속성을 분석하여 상황에 맞는 차별화된 전략을 제공합니다. 이를 통해 강한 상승 추세에서 조기 매도로 인한 기회 손실을 방지하고, 일반적인 밴드타기에서는 적절한 매도 시점을 제안하여 수익을 극대화할 수 있습니다. 