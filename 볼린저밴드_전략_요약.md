# 볼린저 밴드 기반 자동 주식 거래 신호 시스템

## 시스템 개요
볼린저 밴드를 기반으로 주식/ETF 거래 신호를 자동으로 생성하고 Slack을 통해 알림을 제공하는 시스템입니다. 주요 종목을 모니터링하고 매수/매도 시점과 위험 관리 전략을 제안합니다.

## 주요 기능 개선 사항

### 1. 분할 매수 전략 구현
- **단계별 매수**:
  - 하단밴드 터치 시(%B ≤ 0.2, > 0.1): 첫 매수 (총 자금의 25%)
  - 추가 하락 시(%B ≤ 0.1, > 0.05): 추가 매수 (총 자금의 35%)
  - 급격한 하락 시(%B ≤ 0.05): 안전망 매수 (총 자금의 40%)

- **익절 전략**:
  - MA25(중심선) 도달 시(0.45 ≤ %B ≤ 0.55): 보유 물량의 50% 익절 고려
  - 중심선 상향 돌파 시(0.55 < %B ≤ 0.7): 남은 물량 유지하고 상단밴드 터치까지 홀딩
  - 상단밴드 접근 시(%B > 0.7): 남은 물량 전량 매도 검토

### 2. 손절 전략 최적화
- **매매 유형별 손절 전략**:
  - **돌파 매매**: 밴드 상단선 아래로 내려올 때 손절 (상단선 = %B < 0.8 지점)
  - **하단 매수**: 추가 하락 시 손절보다는 평균단가 낮추기 전략 사용

- **위험 수준별 손절 비율**:
  - 저위험: 5% 이내
  - 중위험: 7% 내외
  - 고위험: 10% 이상

### 3. 밴드타기 현상 감지 기능
- **감지 방법**:
  - 최근 5일 동안 %B 값이 0.8 이상인 날을 확인
  - 연속 3일 이상 상단밴드 접촉 시 밴드타기로 간주
  - 밴드타기 강도(0-100%)를 계산하여 대응 전략 차별화

- **강한 상승 추세 감지**:
  - 가격 상승일이 70% 이상이고 거래량 증가 또는 %B가 0.9 이상일 때 강한 추세로 판단
  - 단순 상단 접촉만으로 매도하지 않고 **추세를 지속적으로 관찰**
  - 트레일링 스탑(Trailing Stop) 전략으로 이익을 보호하며 추세 추종

- **일반적인 밴드타기 대응**:
  - 강도 70% 이상: 조만간 추세 전환 가능성 높음 - 이익실현 고려
  - 강도 40-70%: 중간 강도 - 분할 매도 검토
  - 강도 40% 미만: 약한 밴드타기 - 주의 관찰

### 4. 위험 관리 시스템 강화
- **분할 매매로 리스크 분산**:
  - 매수 시 위험 수준별 분할 전략:
    - 저위험: 총 4-5회 나누어 진입, 한 번에 15-20% 자금만 투입
    - 중위험: 총 3회 나누어 진입, 한 번에 25-30% 자금 투입
    - 고위험: 총 2회 나누어 진입, 한 번에 40-50% 자금 투입
  - 매도 시 위험 수준별 분할 전략:
    - 저위험: 총 2회 나누어 90% 이상 매도, 첫 매도에 70% 실현
    - 중위험: 총 3회 나누어 70-80% 매도, 가격에 따라 분할 실현
    - 고위험: 총 3-4회 나누어 50-70% 매도, 나머지는 추세 유지 시 홀딩

- **MFI 지표 병행 확인**:
  - 매수 시 MFI 20 이하(과매도)면 매수 신호 강화, 50 이상이면 매수 시점 재검토
  - 매도 시 MFI 80 이상(과매수)이면 매도 신호 강화, 50 이하면 매도 시점 재검토
  - 볼린저 밴드와 MFI 지표가 일치할 때 신호 신뢰도 상승

- **추세 변화 시 신속한 대응 (밴드 기울기 변화 주시)**:
  - 밴드 기울기 상승 중: 상승 추세 확인, %B > 0.5이면 상승 모멘텀 활용
  - 밴드 기울기 하락 중: 하락 추세 확인, %B < 0.5이면 하락 가속화 가능성 주의
  - 하단밴드 기울기가 수평/상승으로 전환 시 매수 신호 강화
  - 상단밴드 기울기가 수평/하락으로 전환 시 매도 신호 강화

- **목표 수익률 도달 시 일부 이익 실현**:
  - 목표 수익률의 70% 도달 시 일부 이익 실현 시작
  - 목표 수익률 100% 달성 시 위험 수준에 따라 50-90% 익절

## 실행 결과

### 최근 분석된 ETF/채권 주요 결과
| 종목 | 현재 가격 | 현재 수익률 | 목표 달성률 | 추천 전략 | 알림 여부 |
|------|----------|------------|-----------|----------|----------|
| SPY  | $550.64  | 8.26%      | 82.6%     | 중심선 상향 돌파, 홀딩, 30-40% 익절 고려 | - |
| SCHD | $25.67   | 2.44%      | 24.4%     | 특별한 신호 없음, 추세 유지 | - |
| O    | $56.89   | 0.35%      | 3.5%      | 중심선 상향 돌파, 홀딩 | - |
| JEPQ | $51.09   | 4.16%      | 41.6%     | 중심선 상향 돌파, 홀딩 | - |
| BIL  | $91.70   | 0.21%      | 2.1%      | 매도 확률 44%, 밴드타기 감지, 분할 매도 | ✓ |
| SGOV | $100.65  | 0.07%      | 0.7%      | 강한 상승 추세, 트레일링 스탑 | ✓ |
| TLT  | $88.89   | 1.85%      | 18.5%     | 중심선 도달, 50% 익절 고려 | - |
| TLTW | $23.53   | 1.43%      | 14.3%     | 중심선 상향 돌파, 홀딩 | - |

### 주요 시그널 결과
- **매수 시그널**: 현재 모든 종목이 매수 확률 낮음 (30% 이하)
- **매도 시그널**: BIL과 SGOV에서 매도 확률 44%로 분할 매도 고려
- **밴드타기 감지**: BIL(56% 강도)과 SGOV(57% 강도)에서 감지
- **Slack 알림**: BIL과 SGOV에 대해 자동으로 알림 전송됨

## 사용 방법
```bash
# 기본 실행
python main.py --now --stock-info SPY/508.62/10

# 옵션 추가 실행
python main.py --now --stock-info SPY/508.62/10 --tranche=3 --stop-loss=7 --band-riding=true --risk-management=medium

# 모든 ETF 분석
./main.sh
```

## 결론
이 시스템은 볼린저 밴드 기반의 강력한 트레이딩 전략을 제공하며, 분할 매수, 손절 최적화, 밴드타기 감지, 위험 관리 기능을 통해 효과적인 투자 의사결정을 지원합니다. 특히 매수/매도 시점 판단뿐만 아니라 위험 관리와 자금 배분에 대한 체계적인 접근법을 제시합니다. 